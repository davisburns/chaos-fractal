<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zoomable Chaos Fractal Generator (Seamless Loop)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      font-family: sans-serif;
      color: white;
    }
    h2 {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      text-align: center;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
      background: #000;
    }
    .controls {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      z-index: 2;
    }
    button, select, input[type=range] {
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    label {
      display: flex;
      align-items: center;
      gap: 5px;
    }
  </style>
</head>
<body>
  <h2>ðŸŒˆ Seamless Looping Chaos Fractal Generator</h2>
  <canvas id="canvas"></canvas>
  <div class="controls">
    <button onclick="randomizeFractal()">ðŸŽ² Randomize</button>
    <button onclick="startRecording()">ðŸŽ¥ Record 10s & Download</button>
    <button onclick="setZoomMode('bounce')">Bounce Zoom</button>
    <button onclick="setZoomMode('endless')">Endless Zoom</button>
    <label>Zoom: <input type="range" id="zoomAmount" min="0" max="0.3" step="0.001" value="0.05"></label>
    <label>Fade: <input type="range" id="fadeIntensity" min="0" max="0.2" step="0.01" value="0.04"></label>
    <label>Colors:
      <select id="colorPreset" onchange="applyColorPreset()">
        <option value="rainbow">Rainbow</option>
        <option value="neon">Neon</option>
        <option value="pastel">Pastel</option>
        <option value="white">White</option>
      </select>
    </label>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    // Offscreen buffer canvas for recording
    const bufferCanvas = document.createElement("canvas");
    bufferCanvas.width = 1920;
    bufferCanvas.height = 1080;
    const bufferCtx = bufferCanvas.getContext("2d");

    let vertices = [];
    let point = {};
    let frame = 0;
    const totalFrames = 600;
    let animationId;
    let colors = [];
    let zoomMode = 'bounce';

    const presets = {
      rainbow: ["#00f7ff", "#ff00e6", "#fff200", "#00ff8f", "#ff6a00", "#ff3366", "#33ff66", "#66ccff"],
      neon: ["#39ff14", "#ff073a", "#0ff", "#f0f", "#ffea00", "#00f0ff"],
      pastel: ["#ffb3ba", "#ffdfba", "#ffffba", "#baffc9", "#bae1ff"],
      white: ["#ffffff"]
    };

    function applyColorPreset() {
      const selected = document.getElementById("colorPreset").value;
      colors = presets[selected];
    }

    function setZoomMode(mode) {
      zoomMode = mode;
      frame = 0;
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function randomizeFractal() {
      const shapeTypes = ["circle", "star", "flower", "spiral", "blob", "noise"];
      const shape = shapeTypes[Math.floor(Math.random() * shapeTypes.length)];

      const centerX = bufferCanvas.width / 2;
      const centerY = bufferCanvas.height / 2;
      const radius = 480;
      const numPoints = shape === "circle" ? 3 + Math.floor(Math.random() * 5) : 100;

      vertices = [];

      if (shape === "circle") {
        vertices = Array.from({ length: numPoints }, (_, i) => ({
          x: centerX + Math.cos(i * 2 * Math.PI / numPoints) * radius,
          y: centerY + Math.sin(i * 2 * Math.PI / numPoints) * radius
        }));
      } else if (shape === "star") {
        const spikes = 5 + Math.floor(Math.random() * 5);
        for (let i = 0; i < spikes * 2; i++) {
          const angle = i * Math.PI / spikes;
          const r = i % 2 === 0 ? radius : radius / 2;
          vertices.push({
            x: centerX + Math.cos(angle) * r,
            y: centerY + Math.sin(angle) * r
          });
        }
      } else if (shape === "flower") {
        const petals = 5 + Math.floor(Math.random() * 5);
        for (let i = 0; i < petals * 10; i++) {
          const angle = i * (Math.PI * 2) / (petals * 10);
          const r = radius * Math.sin(petals * angle);
          vertices.push({
            x: centerX + r * Math.cos(angle),
            y: centerY + r * Math.sin(angle)
          });
        }
      } else if (shape === "spiral") {
        for (let i = 0; i < numPoints; i++) {
          const angle = 0.2 * i;
          const r = 0.5 * i;
          vertices.push({
            x: centerX + r * Math.cos(angle),
            y: centerY + r * Math.sin(angle)
          });
        }
      } else if (shape === "blob") {
        for (let i = 0; i < numPoints; i++) {
          const angle = i * (Math.PI * 2 / numPoints);
          const r = radius * (0.8 + Math.random() * 0.4);
          vertices.push({
            x: centerX + r * Math.cos(angle),
            y: centerY + r * Math.sin(angle)
          });
        }
      } else {
        for (let i = 0; i < numPoints; i++) {
          vertices.push({
            x: Math.random() * bufferCanvas.width,
            y: Math.random() * bufferCanvas.height
          });
        }
      }

      point = {
        x: Math.random() * bufferCanvas.width,
        y: Math.random() * bufferCanvas.height
      };

      frame = 0;
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      bufferCtx.fillStyle = "#000";
      bufferCtx.fillRect(0, 0, bufferCanvas.width, bufferCanvas.height);
      cancelAnimationFrame(animationId);
      drawFrame();
    }

    function drawFrame() {
      const fade = parseFloat(document.getElementById("fadeIntensity").value);
      const zoomAmount = parseFloat(document.getElementById("zoomAmount").value);

      [ctx, bufferCtx].forEach(context => {
        context.globalAlpha = 1;
        context.fillStyle = `rgba(0, 0, 0, ${fade})`;
        context.fillRect(0, 0, context.canvas.width, context.canvas.height);
      });

      let zoom = 1;
      if (zoomMode === 'bounce') {
        zoom = 1 + Math.sin((frame / totalFrames) * 2 * Math.PI) * zoomAmount;
      } else if (zoomMode === 'endless') {
        zoom = 1 + (frame * zoomAmount / totalFrames);
      }

      for (let i = 0; i < 5000; i++) {
        const seed = Math.sin((frame + i) * 0.05) * 1000;
        const index = Math.abs(Math.floor(seed) % vertices.length);
        const v = vertices[index];

        point.x = (point.x + v.x) / 2;
        point.y = (point.y + v.y) / 2;

        [ctx, bufferCtx].forEach(context => {
          const w = context.canvas.width;
          const h = context.canvas.height;
          const zx = (point.x - w / 2) * zoom + w / 2;
          const zy = (point.y - h / 2) * zoom + h / 2;
          const color = colors[(frame + i) % colors.length];
          context.fillStyle = color;
          context.fillRect(Math.round(zx), Math.round(zy), 1, 1);
        });
      }

      frame = (frame + 1) % totalFrames;
      animationId = requestAnimationFrame(drawFrame);
    }

    function startRecording() {
      const stream = bufferCanvas.captureStream(60);
      const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
      const chunks = [];

      recorder.ondataavailable = e => chunks.push(e.data);
      recorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'fractal_loop_seamless.webm';
        a.click();
      };

      recorder.start();
      setTimeout(() => recorder.stop(), 10000);
    }

    applyColorPreset();
    randomizeFractal();
  </script>
</body>
</html>
